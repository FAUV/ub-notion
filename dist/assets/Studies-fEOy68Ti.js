import{b as j,u as f,j as e}from"./vendor-query-CfuGqJst.js";import{r as n}from"./vendor-react-Ba_DDsk4.js";import{i as N}from"./importCsv-Dai6I4rs.js";import{V as g}from"./ViewBar-GmxfLOF8.js";import{d as y}from"./index-uMaUSKow.js";import{T as b}from"./Timeline-cZrqngIZ.js";import"./date-CZKpIZnz.js";import"./parseISO-Clwiv-83.js";import"./vendor-charts-Ci5G67-A.js";const x={all:["studies"]};async function v(){return y.studies.orderBy("name").toArray()}function k(){return j({queryKey:x.all,queryFn:v,staleTime:6e4})}function C(a,c,l,i){return!a||!c||!l||!i||i===0?0:Math.round(a*c*l/i*10)/10}function Q(){const[a,c]=n.useState("rice"),l=f(),{data:i=[],isLoading:m}=k(),t=n.useMemo(()=>i.map(s=>({...s,rice:C(s.reach,s.impact,s.confidence,s.effort)})).sort((s,r)=>r.rice-s.rice),[i]),p=n.useMemo(()=>{if(!t.length)return 0;const s=t.reduce((r,d)=>r+d.rice,0);return Math.round(s/t.length*10)/10},[t]),h=n.useMemo(()=>t.filter(s=>s.startDate&&s.endDate).map(s=>({id:s.id,name:s.name,startDate:s.startDate,endDate:s.endDate,category:s.kind})),[t]);async function u(s){var o;const r=(o=s.target.files)==null?void 0:o[0];if(!r)return;const d=await r.text();await N("studies",d),await l.invalidateQueries({queryKey:x.all})}return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Estudios"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"btn cursor-pointer",children:["Importar CSV",e.jsx("input",{type:"file",accept:".csv",className:"hidden",onChange:u})]})})]}),e.jsxs("section",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("article",{className:"card p-4",children:[e.jsx("header",{className:"text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Total iniciativas"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:t.length})]}),e.jsxs("article",{className:"card p-4",children:[e.jsx("header",{className:"text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Promedio RICE"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:p})]}),e.jsxs("article",{className:"card p-4",children:[e.jsx("header",{className:"text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"En curso"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:t.filter(s=>s.status==="En curso").length})]})]}),e.jsx(g,{items:[{key:"rice",label:"RICE"},{key:"timeline",label:"Cronograma"}],active:a,onChange:c}),m&&e.jsx("div",{className:"card p-4 text-sm opacity-80",children:"Cargando estudios..."}),a==="rice"&&e.jsx("div",{className:"card p-0 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"text-left text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Estudio"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Tipo"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Reach"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Impact"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Confidence"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Effort"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"RICE"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-800",children:[t.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50/60 dark:hover:bg-slate-800/60",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-medium",children:s.name}),s.summary&&e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:s.summary})]}),e.jsx("td",{className:"px-4 py-3",children:s.kind}),e.jsx("td",{className:"px-4 py-3",children:s.status}),e.jsx("td",{className:"px-4 py-3",children:s.reach??"—"}),e.jsx("td",{className:"px-4 py-3",children:s.impact??"—"}),e.jsx("td",{className:"px-4 py-3",children:s.confidence??"—"}),e.jsx("td",{className:"px-4 py-3",children:s.effort??"—"}),e.jsx("td",{className:"px-4 py-3 font-semibold",children:s.rice})]},s.id)),!t.length&&!m&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-6 text-center text-sm opacity-70",children:"No hay estudios registrados."})})]})]})}),a==="timeline"&&e.jsx(b,{items:h,emptyMessage:"Agrega fechas de inicio y fin para visualizar el cronograma."})]})}export{Q as default};
