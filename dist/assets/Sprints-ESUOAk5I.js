import{b as D,u as v,j as e}from"./vendor-query-CfuGqJst.js";import{r as f}from"./vendor-react-Ba_DDsk4.js";import{i as w}from"./importCsv-Dai6I4rs.js";import{V as k}from"./ViewBar-GmxfLOF8.js";import{d as S,e as C,c as I,f as M}from"./index-uMaUSKow.js";import{u as L}from"./tasks-t6ey88ep.js";import{R as T,L as K,c as A,X as Q,Y as q,T as B,d as N}from"./vendor-charts-Ci5G67-A.js";import{p as o}from"./parseISO-Clwiv-83.js";const b={all:["sprints"]};async function V(){return S.sprints.orderBy("startDate").toArray()}function E(){return D({queryKey:b.all,queryFn:V,staleTime:6e4})}function F({sprints:a}){const m=a.filter(t=>t.startDate&&o(t.startDate)>new Date).length,c=a.filter(t=>{if(!t.startDate||!t.endDate)return!1;const l=o(t.startDate),d=o(t.endDate),r=new Date;return l<=r&&r<=d}).length;return e.jsxs("section",{className:"grid gap-3 md:grid-cols-3",children:[e.jsxs("article",{className:"card p-4",children:[e.jsx("header",{className:"text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Sprints totales"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:a.length})]}),e.jsxs("article",{className:"card p-4",children:[e.jsx("header",{className:"text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"En curso"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:c})]}),e.jsxs("article",{className:"card p-4",children:[e.jsx("header",{className:"text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400",children:"Próximos"}),e.jsx("p",{className:"text-2xl font-semibold mt-2",children:m})]})]})}function R(a,m){if(!a.startDate||!a.endDate)return[];const c=o(a.startDate),t=o(a.endDate),l=Math.max(C(t,c),1),d=m.filter(x=>x.sprintId===a.id),r=d.length;return r?Array.from({length:l+1}).map((x,p)=>{const n=I(c,p),h=d.filter(i=>i.status==="Done"&&i.endDate&&o(i.endDate)<=n).length,j=Math.max(r-h,0),u=l===0?r:r/l,s=Math.max(Math.round(r-u*p),0);return{day:M(n,"MM-dd"),ideal:s,remaining:j}}):[]}function z(){const[a,m]=f.useState("list"),c=v(),{data:t=[],isLoading:l}=E(),{data:d=[],isLoading:r}=L(),[x,p]=f.useState(null),n=f.useMemo(()=>{var i;if(!t.length)return null;const s=x??((i=t[t.length-1])==null?void 0:i.id);return t.find(y=>y.id===s)??t[0]},[x,t]),h=f.useMemo(()=>n?R(n,d):[],[n,d]);async function j(s){var g;const i=(g=s.target.files)==null?void 0:g[0];if(!i)return;const y=await i.text();await w("sprints",y),await c.invalidateQueries({queryKey:b.all})}const u="sprint-select";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Sprints"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("label",{className:"btn cursor-pointer",children:["Importar CSV",e.jsx("input",{type:"file",accept:".csv",className:"hidden",onChange:j})]})})]}),e.jsx(F,{sprints:t}),e.jsx(k,{items:[{key:"list",label:"Lista"},{key:"burndown",label:"Burn-down"}],active:a,onChange:s=>m(s)}),(l||r)&&e.jsx("div",{className:"card p-4 text-sm opacity-80",children:"Cargando datos de sprints..."}),a==="list"&&e.jsx("div",{className:"card p-0 overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"text-left text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400 border-b border-slate-200 dark:border-slate-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 font-medium",children:"Sprint"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Inicio"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Fin"}),e.jsx("th",{className:"px-4 py-3 font-medium",children:"Capacidad (hrs)"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-800",children:[t.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50/60 dark:hover:bg-slate-800/60",children:[e.jsx("td",{className:"px-4 py-3",children:s.name}),e.jsx("td",{className:"px-4 py-3",children:s.startDate}),e.jsx("td",{className:"px-4 py-3",children:s.endDate}),e.jsx("td",{className:"px-4 py-3",children:s.capacityHours??"—"})]},s.id)),!t.length&&!l&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-4 py-6 text-center text-sm opacity-70",children:"No hay sprints registrados."})})]})]})}),a==="burndown"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("label",{className:"text-sm font-medium",htmlFor:u,children:"Sprint"}),e.jsx("select",{className:"input",id:u,value:(n==null?void 0:n.id)??"",onChange:s=>p(s.target.value||null),children:t.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),n&&h.length?e.jsx("div",{className:"card p-4",children:e.jsx("div",{className:"h-72",children:e.jsx(T,{width:"100%",height:"100%",children:e.jsxs(K,{data:h,margin:{top:10,right:20,left:0,bottom:0},children:[e.jsx(A,{strokeDasharray:"3 3",strokeOpacity:.2}),e.jsx(Q,{dataKey:"day"}),e.jsx(q,{allowDecimals:!1}),e.jsx(B,{}),e.jsx(N,{type:"monotone",dataKey:"ideal",stroke:"#94a3b8",strokeWidth:2,dot:!1}),e.jsx(N,{type:"monotone",dataKey:"remaining",stroke:"#0ea5e9",strokeWidth:2})]})})})}):e.jsx("div",{className:"card p-4 text-sm opacity-80",children:"No hay datos suficientes para el burn-down del sprint seleccionado."})]})]})}export{z as default};
